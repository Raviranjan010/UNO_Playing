<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>UNO â€” Royal Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;900&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --g1:#1a0a00; --g2:#2d1200; --g3:#4a2000;
  --gold:#d4a847; --gold2:#f0c860; --gold3:#b8922e;
  --red:#c0392b; --yellow:#d4940a; --green:#1a6b3c; --blue:#1a4f8a; --wild:#7b2fbe;
  --cream:#f5e6c8; --smoke:#d4c4a0;
  --card-w:76px; --card-h:114px;
  --card-sm-w:48px; --card-sm-h:72px;
  --radius:12px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;overflow:hidden;background:#0a0500;font-family:'Raleway',sans-serif}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen{position:fixed;inset:0;display:none;flex-direction:column;overflow:hidden}
.screen.active{display:flex}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MENU SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#menu{
  background:radial-gradient(ellipse 80% 80% at 50% 40%, #3d1a00 0%, #1a0800 40%, #080300 100%);
  align-items:center;justify-content:center;
}
#menu::before{
  content:'';position:absolute;inset:0;pointer-events:none;
  background:
    radial-gradient(circle at 20% 20%, rgba(212,168,71,.06) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(212,168,71,.06) 0%, transparent 50%);
}
/* subtle noise */
#menu::after{
  content:'';position:absolute;inset:0;pointer-events:none;opacity:.03;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
}

/* Decorative corner SVG frames */
.menu-corner{position:absolute;width:120px;height:120px;pointer-events:none;opacity:.35}
.menu-corner.tl{top:0;left:0}
.menu-corner.tr{top:0;right:0;transform:scaleX(-1)}
.menu-corner.bl{bottom:0;left:0;transform:scaleY(-1)}
.menu-corner.br{bottom:0;right:0;transform:scale(-1)}

/* Floating bg cards */
.bg-card{position:absolute;pointer-events:none;opacity:.1}

/* â”€â”€ Menu card â€“ the main content box â”€â”€ */
.menu-box{
  position:relative;z-index:10;
  display:flex;flex-direction:column;align-items:center;
  background:linear-gradient(160deg,rgba(255,255,255,.04) 0%,rgba(255,255,255,.01) 100%);
  border:1px solid rgba(212,168,71,.25);
  border-radius:28px;
  padding:52px 64px 48px;
  box-shadow:0 0 0 1px rgba(212,168,71,.08),0 40px 100px rgba(0,0,0,.6),inset 0 1px 0 rgba(212,168,71,.15);
  backdrop-filter:blur(4px);
  animation:menuIn .7s cubic-bezier(.22,1,.36,1) both;
  max-width:480px;width:90vw;
}
@keyframes menuIn{from{opacity:0;transform:translateY(32px) scale(.97)}to{opacity:1;transform:none}}

.menu-eyebrow{
  font-family:'Cinzel',serif;font-size:10px;font-weight:600;
  letter-spacing:6px;color:var(--gold);opacity:.6;
  text-transform:uppercase;margin-bottom:18px;
}
.menu-logo{
  font-family:'Cinzel',serif;font-weight:900;
  font-size:clamp(72px,14vw,96px);
  line-height:.85;letter-spacing:12px;
  color:transparent;
  -webkit-text-stroke:2px var(--gold);
  filter:drop-shadow(0 0 30px rgba(212,168,71,.3));
  user-select:none;margin-bottom:6px;
}
.menu-sub{
  font-family:'Raleway',sans-serif;font-size:12px;font-weight:500;
  color:var(--smoke);opacity:.45;letter-spacing:4px;text-transform:uppercase;
  margin-bottom:36px;
}
/* Ornamental divider */
.orn-divider{
  display:flex;align-items:center;gap:12px;width:100%;margin-bottom:32px;
}
.orn-line{flex:1;height:1px}
.orn-line.l{background:linear-gradient(to right,transparent,rgba(212,168,71,.45))}
.orn-line.r{background:linear-gradient(to left,transparent,rgba(212,168,71,.45))}
.orn-diamond{
  width:8px;height:8px;background:var(--gold);transform:rotate(45deg);
  box-shadow:0 0 8px rgba(212,168,71,.6);flex-shrink:0;
}

/* Player count */
.section-label{
  font-size:9px;letter-spacing:5px;text-transform:uppercase;
  color:var(--gold);opacity:.45;margin-bottom:14px;text-align:center;
}
.player-picker{display:flex;gap:10px;justify-content:center;margin-bottom:32px}
.p-btn{
  width:56px;height:56px;border-radius:12px;cursor:pointer;
  font-family:'Cinzel',serif;font-weight:700;font-size:22px;
  transition:all .2s cubic-bezier(.34,1.56,.64,1);outline:none;
  border:1.5px solid rgba(212,168,71,.2);
  background:rgba(212,168,71,.06);color:rgba(212,168,71,.5);
}
.p-btn:hover{transform:scale(1.08);border-color:rgba(212,168,71,.5);color:var(--gold)}
.p-btn.sel{
  background:linear-gradient(145deg,rgba(212,168,71,.85),rgba(184,146,46,.6));
  border-color:var(--gold);color:#1a0800;
  box-shadow:0 0 20px rgba(212,168,71,.35),0 4px 14px rgba(0,0,0,.4);
  transform:scale(1.06);
}

/* Deal button */
.deal-btn{
  width:100%;padding:16px 0;border-radius:50px;border:none;cursor:pointer;
  background:linear-gradient(135deg,var(--gold2) 0%,var(--gold) 50%,var(--gold3) 100%);
  color:#1a0800;font-family:'Cinzel',serif;font-size:14px;font-weight:700;
  letter-spacing:5px;text-transform:uppercase;
  box-shadow:0 8px 28px rgba(212,168,71,.4),inset 0 1px 0 rgba(255,255,255,.3);
  transition:all .2s;margin-bottom:28px;
  position:relative;overflow:hidden;
}
.deal-btn::after{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(255,255,255,.15) 0%,transparent 50%);
}
.deal-btn:hover{transform:translateY(-2px);box-shadow:0 14px 40px rgba(212,168,71,.55),inset 0 1px 0 rgba(255,255,255,.3)}
.deal-btn:active{transform:translateY(0)}

/* Legend row */
.legend{display:flex;gap:0;justify-content:center;flex-wrap:wrap}
.legend-item{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  padding:8px 12px;
  color:var(--smoke);opacity:.3;font-size:10px;letter-spacing:.5px;
  border-right:1px solid rgba(212,168,71,.1);
}
.legend-item:last-child{border-right:none}
.legend-sym{font-family:'Cinzel',serif;font-size:18px;color:var(--gold)}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME SCREEN â€” GRID LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game{
  background:radial-gradient(ellipse 100% 100% at 50% 50%, #1a3d20 0%, #0a2010 45%, #040c06 100%);
  /* Fixed 3-row layout: opponents / table / player-zone */
  grid-template-rows:auto 1fr auto;
  gap:0;
}
#game.active{display:grid}

/* Felt texture */
#game::before{
  content:'';position:absolute;inset:0;pointer-events:none;z-index:0;
  background-image:
    repeating-linear-gradient(0deg,rgba(255,255,255,.015) 0,rgba(255,255,255,.015) 1px,transparent 1px,transparent 28px),
    repeating-linear-gradient(90deg,rgba(255,255,255,.015) 0,rgba(255,255,255,.015) 1px,transparent 1px,transparent 28px);
}
/* oval table border */
#game::after{
  content:'';position:absolute;inset:8px 14px;
  border-radius:200px;
  border:1.5px solid rgba(212,168,71,.12);
  box-shadow:inset 0 0 140px rgba(0,0,0,.5),0 0 60px rgba(0,0,0,.7);
  pointer-events:none;z-index:0;
}

/* Dynamic color glow at center */
#aura{
  position:absolute;top:50%;left:50%;
  width:500px;height:320px;border-radius:50%;
  transform:translate(-50%,-50%);
  transition:background .8s ease;pointer-events:none;z-index:1;
}

/* â”€â”€ ROW 1 â€“ OPPONENTS â”€â”€ */
#row-opponents{
  position:relative;z-index:10;
  display:flex;justify-content:center;align-items:flex-start;
  gap:20px;padding:16px 24px 0;
  flex-wrap:wrap;
}

/* â”€â”€ ROW 2 â€“ CENTER TABLE â”€â”€ */
#row-table{
  position:relative;z-index:10;
  display:flex;align-items:center;justify-content:center;
  gap:28px;padding:0 20px;
}

/* â”€â”€ ROW 3 â€“ PLAYER ZONE â”€â”€ */
#row-player{
  position:relative;z-index:10;
  display:flex;flex-direction:column;align-items:center;
  background:linear-gradient(to top,rgba(4,12,6,.97) 0%,rgba(4,12,6,.8) 60%,transparent 100%);
  padding:10px 16px 16px;gap:10px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OPPONENT CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.opp-card{
  display:flex;flex-direction:column;align-items:center;gap:8px;
}
.seat{
  display:flex;align-items:center;gap:9px;
  padding:8px 14px;border-radius:50px;
  border:1.5px solid rgba(212,168,71,.1);
  background:rgba(0,0,0,.3);
  transition:all .35s ease;
}
.seat.active{
  border-color:var(--sa,rgba(212,168,71,.5));
  background:var(--sab,rgba(212,168,71,.1));
  box-shadow:0 0 20px var(--sas,rgba(212,168,71,.2));
}
.avatar{
  width:32px;height:32px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-family:'Cinzel',serif;font-weight:700;color:#fff;font-size:13px;
  border:2px solid rgba(212,168,71,.25);flex-shrink:0;transition:all .3s;
  background:rgba(212,168,71,.15);
}
.seat.active .avatar{border-color:var(--sa,var(--gold));box-shadow:0 0 10px var(--sas,rgba(212,168,71,.4))}
.seat-info{display:flex;flex-direction:column;gap:2px}
.seat-name{font-size:10px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:rgba(245,230,200,.4);transition:color .3s}
.seat.active .seat-name{color:var(--cream)}
.seat-count{display:flex;align-items:center;gap:5px}
.seat-num{font-family:'Cinzel',serif;font-size:12px;font-weight:700;color:rgba(212,168,71,.35);transition:color .3s}
.seat.active .seat-num{color:var(--gold)}
.uno-badge{
  font-size:9px;font-weight:700;letter-spacing:1px;color:var(--yellow);
  background:rgba(212,148,10,.2);border:1px solid rgba(212,148,10,.4);
  border-radius:20px;padding:1px 6px;animation:unoPulse .8s ease infinite;
}
@keyframes unoPulse{0%,100%{box-shadow:0 0 0 0 rgba(212,148,10,.4)}50%{box-shadow:0 0 0 4px rgba(212,148,10,0)}}

/* Bot fan */
.bot-fan{
  position:relative;display:flex;align-items:flex-end;
  min-width:60px;min-height:50px;
}
.fan-card{position:absolute;transform-origin:bottom center}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CENTER TABLE ELEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.table-block{display:flex;flex-direction:column;align-items:center;gap:8px}
.tbl-label{font-size:9px;letter-spacing:3px;text-transform:uppercase;color:rgba(212,168,71,.3)}

/* Draw pile */
.draw-stack{position:relative;width:var(--card-w);height:var(--card-h);cursor:pointer;transition:transform .2s}
.draw-stack:hover{transform:translateY(-8px)}
.draw-layer{position:absolute}
.draw-layer.l2{top:3px;left:2px;opacity:.45}
.draw-layer.l1{top:1.5px;left:1px;opacity:.7}
.draw-layer.l0{top:0;left:0}
.draw-active-ring{
  position:absolute;inset:-3px;border-radius:14px;
  border:2px solid var(--blue);
  box-shadow:0 0 16px rgba(26,79,138,.6);
  animation:ringPulse 1.4s ease infinite;display:none;
}
.draw-active-ring.show{display:block}
@keyframes ringPulse{0%,100%{opacity:1}50%{opacity:.3}}

/* Info panel */
.info-panel{
  display:flex;flex-direction:column;align-items:center;gap:10px;
  min-width:120px;
}
.color-chip{
  display:flex;align-items:center;gap:8px;
  padding:8px 18px;border-radius:50px;border:1.5px solid;
  transition:all .6s ease;font-size:11px;font-weight:600;
  letter-spacing:2px;text-transform:uppercase;
}
.chip-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.chip-dir{font-size:15px;opacity:.75}
.stack-tag{
  padding:5px 14px;border-radius:50px;font-size:11px;font-weight:600;
  letter-spacing:1px;background:rgba(192,57,43,.18);
  border:1.5px solid rgba(192,57,43,.5);color:var(--red);
  display:none;
}
.stack-tag.show{display:block}
.deck-num{font-size:10px;font-weight:500;color:rgba(212,168,71,.35);letter-spacing:1px}

/* Discard pile */
.discard-stack{position:relative;width:var(--card-w);height:var(--card-h)}
.discard-layer{position:absolute;inset:0}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYER ZONE (Bottom)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.player-hud{
  display:flex;align-items:center;justify-content:center;
  gap:12px;flex-wrap:nowrap;width:100%;
}
.human-seat-wrap{flex-shrink:0}
.turn-pill{
  padding:10px 24px;border-radius:50px;border:1.5px solid;
  font-size:12px;font-weight:700;letter-spacing:3px;text-transform:uppercase;
  transition:all .35s;flex-shrink:0;white-space:nowrap;
}
.turn-pill.go{
  background:rgba(26,107,60,.15);border-color:rgba(26,107,60,.55);
  color:var(--green);box-shadow:0 0 18px rgba(26,107,60,.25);
}
.turn-pill.wait{
  background:rgba(0,0,0,.35);border-color:rgba(212,168,71,.12);
  color:rgba(212,168,71,.3);
}
.nav-btn{
  padding:10px 18px;border-radius:50px;
  border:1px solid rgba(212,168,71,.2);background:rgba(212,168,71,.06);
  color:rgba(212,168,71,.6);font-size:11px;font-weight:600;
  letter-spacing:2px;cursor:pointer;text-transform:uppercase;
  font-family:'Raleway',sans-serif;transition:all .2s;flex-shrink:0;white-space:nowrap;
}
.nav-btn:hover{background:rgba(212,168,71,.14);color:var(--gold);border-color:rgba(212,168,71,.4)}

/* Hand scroll */
#hand-wrap{
  width:100%;overflow-x:auto;
  padding:16px 32px 6px;
  display:flex;align-items:flex-end;justify-content:center;
  gap:0;
  scrollbar-width:thin;scrollbar-color:rgba(212,168,71,.25) transparent;
}
#hand-wrap::-webkit-scrollbar{height:3px}
#hand-wrap::-webkit-scrollbar-thumb{background:rgba(212,168,71,.25);border-radius:2px}
.h-card{
  flex-shrink:0;position:relative;transition:transform .2s cubic-bezier(.34,1.56,.64,1);
  cursor:default;
}
.h-card.playable{cursor:pointer}
.h-card.playable:hover{transform:translateY(-22px) scale(1.05) !important}
.h-card.selected{transform:translateY(-30px) scale(1.08) !important;z-index:999!important}
.h-card-dim::after{
  content:'';position:absolute;inset:0;border-radius:var(--radius);
  background:rgba(0,0,0,.5);pointer-events:none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL OVERLAYS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{
  position:fixed;inset:0;z-index:500;
  display:none;align-items:center;justify-content:center;
  background:rgba(2,6,3,.88);backdrop-filter:blur(18px);
}
.overlay.show{display:flex}

/* Color picker */
.color-picker-box{
  background:linear-gradient(160deg,#0c2010,#050c06);
  border:1.5px solid rgba(212,168,71,.35);border-radius:24px;
  padding:48px 56px;text-align:center;
  box-shadow:0 0 0 1px rgba(212,168,71,.07),0 40px 100px rgba(0,0,0,.8),inset 0 1px 0 rgba(212,168,71,.12);
  animation:popIn .3s cubic-bezier(.34,1.56,.64,1);
}
@keyframes popIn{from{opacity:0;transform:scale(.88)}to{opacity:1;transform:none}}
.cp-title{font-family:'Cinzel',serif;font-size:22px;font-weight:700;color:var(--gold);letter-spacing:2px;margin-bottom:6px}
.cp-sub{font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(--smoke);opacity:.3;margin-bottom:36px}
.cp-colors{display:flex;gap:16px;justify-content:center}
.cp-btn{
  width:68px;height:68px;border-radius:14px;
  border:2px solid rgba(212,168,71,.3);cursor:pointer;outline:none;
  transition:all .15s cubic-bezier(.34,1.56,.64,1);
  position:relative;overflow:hidden;
}
.cp-btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,.1);border-radius:12px}
.cp-btn:hover{transform:scale(1.18) translateY(-4px)}

/* Win screen */
.win-box{
  display:flex;flex-direction:column;align-items:center;gap:24px;
  animation:popIn .5s cubic-bezier(.34,1.56,.64,1);
}
.win-ring-outer{
  width:170px;height:170px;border-radius:50%;
  border:2.5px solid var(--gold);
  display:flex;align-items:center;justify-content:center;
  position:relative;
  box-shadow:0 0 50px rgba(212,168,71,.3),inset 0 0 30px rgba(212,168,71,.05);
  animation:spinSlow 7s linear infinite;
}
.win-ring-inner{
  position:absolute;inset:14px;border-radius:50%;
  border:1px solid rgba(212,168,71,.3);
}
.win-icon{
  font-family:'Cinzel',serif;font-size:44px;color:var(--gold);
  text-shadow:0 0 30px var(--gold),0 0 60px rgba(212,168,71,.4);
}
.win-name{
  font-family:'Cinzel',serif;font-weight:900;
  font-size:clamp(36px,7vw,56px);color:var(--gold);
  letter-spacing:6px;text-transform:uppercase;text-align:center;
  text-shadow:0 0 60px rgba(212,168,71,.6),0 4px 20px rgba(0,0,0,.8);
}
.win-label{font-size:11px;letter-spacing:6px;text-transform:uppercase;color:var(--smoke);opacity:.3}
.win-btns{display:flex;gap:12px;margin-top:8px}
.win-play-btn{
  padding:15px 48px;border-radius:50px;border:none;cursor:pointer;
  background:linear-gradient(135deg,var(--gold2),var(--gold3));
  color:#1a0800;font-family:'Cinzel',serif;font-size:13px;font-weight:700;
  letter-spacing:4px;text-transform:uppercase;
  box-shadow:0 8px 28px rgba(212,168,71,.45);transition:all .2s;
}
.win-play-btn:hover{transform:translateY(-2px);box-shadow:0 14px 44px rgba(212,168,71,.65)}
.win-menu-btn{
  padding:15px 28px;border-radius:50px;cursor:pointer;
  border:1.5px solid rgba(212,168,71,.3);background:transparent;
  color:rgba(212,168,71,.7);font-family:'Cinzel',serif;font-size:12px;
  font-weight:600;letter-spacing:3px;text-transform:uppercase;transition:all .2s;
}
.win-menu-btn:hover{background:rgba(212,168,71,.1);color:var(--gold);border-color:var(--gold)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toasts{
  position:fixed;top:20px;left:50%;transform:translateX(-50%);
  z-index:600;display:flex;flex-direction:column;gap:6px;
  align-items:center;pointer-events:none;width:max-content;max-width:90vw;
}
.toast{
  padding:10px 24px;border-radius:50px;border:1px solid;
  color:var(--cream);font-size:12px;font-weight:600;letter-spacing:.5px;
  backdrop-filter:blur(14px);white-space:nowrap;
  box-shadow:0 8px 28px rgba(0,0,0,.5);
  animation:toastIn .3s cubic-bezier(.34,1.56,.64,1);
}
@keyframes toastIn{from{opacity:0;transform:translateY(-12px) scale(.9)}to{opacity:1;transform:none}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED ANIMATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes spinSlow{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes floatCard{0%,100%{transform:var(--ft,translateY(0) rotate(-10deg))}50%{transform:var(--fth,translateY(-16px) rotate(-6deg))}}
@keyframes cardIn{from{opacity:0;transform:translateY(18px) scale(.92)}to{opacity:1;transform:none}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COLOR VARS FOR SEATS (JS injected)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â• MENU â•â•â•â•â•â•â•â•â•â•â• -->
<div id="menu" class="screen active">
  <!-- Corner ornaments -->
  <div class="menu-corner tl">
    <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0 L60 0 Q60 60 0 60 Z" stroke="#d4a847" stroke-width="1" opacity=".8"/>
      <path d="M12 0 L60 0 Q60 48 12 0 Z" stroke="#d4a847" stroke-width=".6" opacity=".4"/>
      <circle cx="7" cy="7" r="3.5" fill="#d4a847" opacity=".7"/>
      <circle cx="16" cy="16" r="2" fill="#d4a847" opacity=".4"/>
      <circle cx="26" cy="26" r="1" fill="#d4a847" opacity=".25"/>
    </svg>
  </div>
  <div class="menu-corner tr">
    <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0 L60 0 Q60 60 0 60 Z" stroke="#d4a847" stroke-width="1" opacity=".8"/>
      <path d="M12 0 L60 0 Q60 48 12 0 Z" stroke="#d4a847" stroke-width=".6" opacity=".4"/>
      <circle cx="7" cy="7" r="3.5" fill="#d4a847" opacity=".7"/>
      <circle cx="16" cy="16" r="2" fill="#d4a847" opacity=".4"/>
    </svg>
  </div>
  <div class="menu-corner bl">
    <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0 L60 0 Q60 60 0 60 Z" stroke="#d4a847" stroke-width="1" opacity=".8"/>
      <circle cx="7" cy="7" r="3.5" fill="#d4a847" opacity=".7"/>
    </svg>
  </div>
  <div class="menu-corner br">
    <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0 L60 0 Q60 60 0 60 Z" stroke="#d4a847" stroke-width="1" opacity=".8"/>
      <circle cx="7" cy="7" r="3.5" fill="#d4a847" opacity=".7"/>
    </svg>
  </div>

  <div id="bg-cards-wrap"></div>

  <div class="menu-box">
    <div class="menu-eyebrow">Royal Card Game</div>
    <div class="menu-logo">UNO</div>
    <div class="menu-sub">Classic Â· Strategy Â· Fun</div>
    <div class="orn-divider">
      <div class="orn-line l"></div>
      <div class="orn-diamond"></div>
      <div class="orn-line r"></div>
    </div>
    <div class="section-label">Number of Players</div>
    <div class="player-picker">
      <button class="p-btn" data-n="2">2</button>
      <button class="p-btn sel" data-n="3">3</button>
      <button class="p-btn" data-n="4">4</button>
    </div>
    <button class="deal-btn" id="deal-btn">âœ¦ &nbsp;Deal the Cards</button>
    <div class="legend">
      <div class="legend-item"><div class="legend-sym">âŠ—</div>Skip</div>
      <div class="legend-item"><div class="legend-sym">â‡Œ</div>Reverse</div>
      <div class="legend-item"><div class="legend-sym">+2</div>Draw Two</div>
      <div class="legend-item"><div class="legend-sym">âœ¦</div>Wild</div>
      <div class="legend-item"><div class="legend-sym">+4</div>Wild +4</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• GAME â•â•â•â•â•â•â•â•â•â•â• -->
<div id="game" class="screen">
  <div id="aura"></div>

  <!-- ROW 1: Opponents -->
  <div id="row-opponents"></div>

  <!-- ROW 2: Center Table -->
  <div id="row-table">
    <!-- Draw Pile -->
    <div class="table-block">
      <div class="tbl-label" id="deck-lbl">â€” cards</div>
      <div class="draw-stack" id="draw-stack">
        <div class="draw-layer l2" id="dl2"></div>
        <div class="draw-layer l1" id="dl1"></div>
        <div class="draw-layer l0" id="dl0"></div>
        <div class="draw-active-ring" id="draw-ring"></div>
      </div>
      <div class="tbl-label" id="draw-hint-lbl" style="color:rgba(26,79,138,.7);opacity:0;transition:opacity .3s">tap to draw</div>
    </div>

    <!-- Info Panel -->
    <div class="info-panel">
      <div class="color-chip" id="color-chip">
        <div class="chip-dot" id="chip-dot"></div>
        <span id="chip-color">red</span>
        <span class="chip-dir" id="chip-dir">â†»</span>
      </div>
      <div class="stack-tag" id="stack-tag">+0</div>
      <div class="deck-num" id="pile-count">0 discarded</div>
    </div>

    <!-- Discard Pile -->
    <div class="table-block">
      <div class="tbl-label">Discard</div>
      <div class="discard-stack" id="discard-stack"></div>
    </div>
  </div>

  <!-- ROW 3: Player Zone -->
  <div id="row-player">
    <div class="player-hud">
      <div class="human-seat-wrap" id="human-seat-wrap"></div>
      <div class="turn-pill wait" id="turn-pill">Waitingâ€¦</div>
      <button class="nav-btn" id="menu-btn">â† Menu</button>
    </div>
    <div id="hand-wrap"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• COLOR MODAL â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="color-overlay">
  <div class="color-picker-box">
    <div class="cp-title">Choose a Color</div>
    <div class="cp-sub">Pick the active suit</div>
    <div class="cp-colors">
      <button class="cp-btn" data-c="red"    style="background:#c0392b"></button>
      <button class="cp-btn" data-c="yellow" style="background:#c9920a"></button>
      <button class="cp-btn" data-c="green"  style="background:#1a6b3c"></button>
      <button class="cp-btn" data-c="blue"   style="background:#1a4f8a"></button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• WIN SCREEN â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="win-overlay">
  <div class="win-box">
    <div class="win-ring-outer">
      <div class="win-ring-inner"></div>
      <div class="win-icon">âœ¦</div>
    </div>
    <div>
      <div class="win-name" id="win-name-el">Player</div>
      <div class="win-label" style="text-align:center;margin-top:6px">wins the round</div>
    </div>
    <div class="win-btns">
      <button class="win-play-btn" id="win-play-btn">Play Again</button>
      <button class="win-menu-btn" id="win-menu-btn">Menu</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• TOASTS â•â•â•â•â•â•â•â•â•â•â• -->
<div id="toasts"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONSTANTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CHEX = { red:'#c0392b', yellow:'#c9920a', green:'#1a6b3c', blue:'#1a4f8a', wild:'#7b2fbe' };
const ACCENT = ['#c0392b','#1a4f8a','#1a6b3c','#c9920a','#7b2fbe'];
const LABELS = { Skip:'âŠ—', Rev:'â‡Œ', '+2':'+2', Wild:'âœ¦', 'W+4':'+4' };
const COLORS = ['red','yellow','green','blue'];
let numPlayers = 3;
let G = null, selectedIdx = null, botTimer = null, toastId = 0;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SVG CARD RENDERER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const WG = `<linearGradient id="wg" x1="0%" y1="0%" x2="100%" y2="100%">
  <stop offset="0%" stop-color="#c0392b"/>
  <stop offset="33%" stop-color="#c9920a"/>
  <stop offset="66%" stop-color="#1a6b3c"/>
  <stop offset="100%" stop-color="#1a4f8a"/>
</linearGradient>`;

function cardSVG(card, opts={}) {
  const sm = opts.sm || false;
  const glow = opts.glow || false;
  const lift = opts.lift || false;
  const cw = sm ? 48 : 76;
  const ch = sm ? 72 : 114;
  const rx = sm ? 7 : 11;
  const isWild = card.kind === 'wild';
  const base = CHEX[card.col] || CHEX.wild;
  const lbl = LABELS[card.val] ?? card.val;
  const darkBg = card.col==='blue'||card.col==='wild'||card.col==='green';
  const txtC = darkBg ? '#f5e6c8' : card.col==='yellow' ? '#2a1500' : '#f5e6c8';
  const cx = cw/2, cy = ch/2;
  const ovalRx = sm ? 13 : 21, ovalRy = sm ? 20 : 33;
  const fsMid = sm ? (lbl.length>2?12:16) : (lbl.length>2?19:25);
  const fsCorner = sm ? 8 : 10;
  const uid = (card.col+card.val).replace(/[^a-z0-9]/gi,'_')+Date.now()%1000;

  let flt = 'filter:';
  if (glow)     flt += `drop-shadow(0 0 10px ${base}) drop-shadow(0 0 22px ${base}99) drop-shadow(0 5px 14px rgba(0,0,0,.65))`;
  else if (lift) flt += `drop-shadow(0 9px 22px ${base}66) drop-shadow(0 3px 9px rgba(0,0,0,.7))`;
  else           flt += `drop-shadow(0 4px 9px rgba(0,0,0,.65))`;

  return `<svg width="${cw}" height="${ch}" viewBox="0 0 ${cw} ${ch}" style="display:block;${flt}">
  <defs>
    <linearGradient id="bg${uid}" x1="15%" y1="0%" x2="85%" y2="100%">
      <stop offset="0%" stop-color="${isWild?'#8b3fcc':base}" stop-opacity="1"/>
      <stop offset="100%" stop-color="${isWild?'#2d1060':base}" stop-opacity="0.7"/>
    </linearGradient>
    <radialGradient id="sh${uid}" cx="28%" cy="28%" r="72%">
      <stop offset="0%" stop-color="rgba(255,255,255,.22)"/>
      <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
    </radialGradient>
    ${isWild ? WG : ''}
  </defs>
  <rect x="2" y="2" width="${cw-4}" height="${ch-4}" rx="${rx}" fill="url(#bg${uid})"/>
  <rect x="2" y="2" width="${cw-4}" height="${ch-4}" rx="${rx}" fill="url(#sh${uid})"/>
  <!-- Gold border -->
  <rect x="2" y="2" width="${cw-4}" height="${ch-4}" rx="${rx}" fill="none" stroke="#d4a847" stroke-width="1.6" stroke-opacity=".65"/>
  <!-- Inner border -->
  <rect x="${sm?5:6}" y="${sm?5:6}" width="${cw-(sm?10:12)}" height="${ch-(sm?10:12)}" rx="${rx-2}" fill="none" stroke="#d4a847" stroke-width=".5" stroke-opacity=".22"/>
  <!-- Oval shape -->
  <ellipse cx="${cx}" cy="${cy}" rx="${ovalRx}" ry="${ovalRy}" fill="rgba(255,255,255,.09)" stroke="rgba(255,255,255,.18)" stroke-width="1"/>
  ${isWild ? `<ellipse cx="${cx}" cy="${cy}" rx="${ovalRx-5}" ry="${ovalRy-9}" fill="url(#wg)" opacity=".88"/>` : ''}
  <!-- Center label -->
  <text x="${cx}" y="${cy+1}" text-anchor="middle" dominant-baseline="middle"
    font-family="'Cinzel','Georgia',serif" font-weight="900" font-size="${fsMid}"
    fill="${txtC}" stroke="rgba(0,0,0,.3)" stroke-width=".5">${lbl}</text>
  <!-- TL corner -->
  <text x="${sm?6:8}" y="${sm?14:17}" font-family="'Cinzel',serif" font-weight="700"
    font-size="${fsCorner}" fill="${txtC}" opacity=".88">${lbl}</text>
  <!-- BR corner rotated -->
  <g transform="rotate(180,${cw-(sm?6:8)},${ch-(sm?10:13)})">
    <text x="${cw-(sm?6:8)}" y="${ch-(sm?10:13)}" text-anchor="middle" dominant-baseline="middle"
      font-family="'Cinzel',serif" font-weight="700"
      font-size="${fsCorner}" fill="${txtC}" opacity=".88">${lbl}</text>
  </g>
  <!-- Shimmer lines -->
  <line x1="${sm?6:8}" y1="${sm?10:13}" x2="${cw-(sm?6:8)}" y2="${sm?10:13}" stroke="rgba(255,255,255,.14)" stroke-width=".7"/>
  <line x1="${sm?6:8}" y1="${ch-(sm?8:11)}" x2="${cw-(sm?6:8)}" y2="${ch-(sm?8:11)}" stroke="rgba(255,255,255,.06)" stroke-width=".7"/>
</svg>`;
}

function backSVG(sm=false) {
  const cw = sm ? 48 : 76, ch = sm ? 72 : 114, rx = sm ? 7 : 11;
  const uid = 'bk'+Math.random().toString(36).slice(2,6);
  return `<svg width="${cw}" height="${ch}" viewBox="0 0 ${cw} ${ch}" style="display:block;filter:drop-shadow(0 4px 9px rgba(0,0,0,.7))">
  <defs>
    <pattern id="p${uid}" patternUnits="userSpaceOnUse" width="${sm?8:10}" height="${sm?8:10}" patternTransform="rotate(45)">
      <line x1="0" y1="0" x2="0" y2="${sm?8:10}" stroke="#d4a847" stroke-width=".7" stroke-opacity=".22"/>
    </pattern>
  </defs>
  <rect x="2" y="2" width="${cw-4}" height="${ch-4}" rx="${rx}" fill="#100618"/>
  <rect x="2" y="2" width="${cw-4}" height="${ch-4}" rx="${rx}" fill="url(#p${uid})"/>
  <rect x="2" y="2" width="${cw-4}" height="${ch-4}" rx="${rx}" fill="none" stroke="#d4a847" stroke-width="1.6" stroke-opacity=".5"/>
  <rect x="${sm?5:6}" y="${sm?5:6}" width="${cw-(sm?10:12)}" height="${ch-(sm?10:12)}" rx="${rx-2}" fill="none" stroke="#d4a847" stroke-width=".5" stroke-opacity=".2"/>
  <ellipse cx="${cw/2}" cy="${ch/2}" rx="${sm?12:18}" ry="${sm?18:27}" fill="none" stroke="#d4a847" stroke-width=".8" stroke-opacity=".35"/>
  <text x="${cw/2}" y="${ch/2+1}" text-anchor="middle" dominant-baseline="middle"
    font-family="'Cinzel',serif" font-weight="900" font-size="${sm?9:13}"
    fill="#d4a847" opacity=".68">UNO</text>
</svg>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DECK & GAME INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function makeDeck() {
  const d=[];
  COLORS.forEach(col => {
    d.push({col,val:'0',kind:'num'});
    for(let n=1;n<=9;n++){d.push({col,val:`${n}`,kind:'num'});d.push({col,val:`${n}`,kind:'num'});}
    ['Skip','Rev','+2'].forEach(v=>{d.push({col,val:v,kind:'act'});d.push({col,val:v,kind:'act'});});
  });
  ['Wild','W+4','Wild','W+4'].forEach(v=>d.push({col:'wild',val:v,kind:'wild'}));
  return d;
}
function shuffle(a) {
  const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;
}
function canPlay(card,top,curCol){
  if(card.kind==='wild') return true;
  if(card.col===curCol)  return true;
  if(card.val===top.val) return true;
  return false;
}
function startGame() {
  clearTimeout(botTimer);
  selectedIdx=null;
  let deck=shuffle(makeDeck());
  const players=Array.from({length:numPlayers},(_,i)=>({id:i,name:i===0?'You':`Player ${i+1}`,hand:[]}));
  for(let i=0;i<7;i++) players.forEach(p=>p.hand.push(deck.pop()));
  let top;
  do{top=deck.pop();if(top.kind==='wild')deck.unshift(top);}while(top.kind==='wild');
  G={deck,pile:[top],players,cur:0,dir:1,curCol:top.col,over:false,winner:null,stack:0};
  closeOverlays();
  showScreen('game');
  renderGame();
  toast('Cards dealt â€” good luck!','#d4a847');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderGame() {
  if(!G) return;
  const acc = CHEX[G.curCol] || '#d4a847';
  const myTurn = G.cur===0;

  // Aura
  document.getElementById('aura').style.background=`radial-gradient(ellipse, ${acc}11 0%, transparent 70%)`;

  // Draw pile backs
  ['dl2','dl1','dl0'].forEach(id=>{ document.getElementById(id).innerHTML=backSVG(); });
  document.getElementById('deck-lbl').textContent=`${G.deck.length} cards`;
  const ring=document.getElementById('draw-ring');
  const hint=document.getElementById('draw-hint-lbl');
  if(myTurn){ring.classList.add('show');hint.style.opacity='1';}
  else{ring.classList.remove('show');hint.style.opacity='0';}
  if(G.stack>0) hint.textContent=`draw +${G.stack}`;
  else hint.textContent='tap to draw';

  // Color chip
  const chip=document.getElementById('color-chip');
  chip.style.background=`${acc}18`;chip.style.borderColor=`${acc}55`;chip.style.color=acc;chip.style.boxShadow=`0 0 14px ${acc}22`;
  document.getElementById('chip-dot').style.cssText=`background:${acc};box-shadow:0 0 8px ${acc}`;
  document.getElementById('chip-color').textContent=G.curCol;
  document.getElementById('chip-dir').textContent=G.dir===1?'â†»':'â†º';

  // Stack tag
  const st=document.getElementById('stack-tag');
  if(G.stack>0){st.classList.add('show');st.textContent=`+${G.stack} draw pending`;}
  else st.classList.remove('show');

  document.getElementById('pile-count').textContent=`${G.pile.length} discarded`;

  // Discard stack
  const ds=document.getElementById('discard-stack');
  ds.innerHTML='';
  const show=G.pile.slice(-4);
  show.forEach((c,i)=>{
    const d=document.createElement('div');
    d.className='discard-layer';
    d.style.cssText=`transform:rotate(${(i-show.length+1)*5}deg) translate(${(i-show.length+1)*2}px,0);z-index:${i};opacity:${i<show.length-1?.68:1}`;
    d.innerHTML=cardSVG(c,{glow:i===show.length-1,lift:i===show.length-1});
    ds.appendChild(d);
  });

  // Turn pill
  const tp=document.getElementById('turn-pill');
  const curName=G.players[G.cur].name;
  if(myTurn){tp.className='turn-pill go';tp.textContent='Your Turn';}
  else{tp.className='turn-pill wait';tp.textContent=`${curName}'s turnâ€¦`;}

  // Opponents
  renderOpponents();
  // Human seat
  renderHumanSeat();
  // Hand
  renderHand();
}

function colorVarsForId(id) {
  const c=ACCENT[id%ACCENT.length];
  // Convert hex to rgba components for CSS var injection
  return c;
}

function renderSeatHTML(player, active) {
  const acc=ACCENT[player.id%ACCENT.length];
  const uno=player.hand.length===1;
  const activeStyle=active?`style="--sa:${acc};--sab:${acc}18;--sas:${acc}22"`:'' ;
  const avatarBg=active?`background:linear-gradient(135deg,${acc},${acc}88)`:`background:rgba(212,168,71,.12)`;
  const avatarBorder=uno?`border-color:${CHEX.yellow}`:active?`border-color:${acc}88`:``;
  return `<div class="seat${active?' active':''}" ${activeStyle}>
    <div class="avatar" style="${avatarBg};${avatarBorder}">${player.name[0].toUpperCase()}</div>
    <div class="seat-info">
      <div class="seat-name">${player.id===0?'You':player.name}</div>
      <div class="seat-count">
        <span class="seat-num">${player.hand.length}</span>
        <span style="font-size:9px;color:rgba(212,168,71,.35);letter-spacing:1px">cards</span>
        ${uno?'<span class="uno-badge">UNO</span>':''}
      </div>
    </div>
  </div>`;
}

function renderHumanSeat() {
  document.getElementById('human-seat-wrap').innerHTML=renderSeatHTML(G.players[0], G.cur===0);
}

function renderOpponents() {
  const zone=document.getElementById('row-opponents');
  zone.innerHTML='';
  G.players.slice(1).forEach(p=>{
    const active=G.cur===p.id;
    const wrap=document.createElement('div');
    wrap.className='opp-card';
    wrap.innerHTML=renderSeatHTML(p,active);

    // Fan
    const fan=document.createElement('div');
    fan.className='bot-fan';
    const count=Math.min(p.hand.length,10);
    const totalWidth=(count-1)*11+48;
    fan.style.width=totalWidth+'px';
    for(let i=0;i<count;i++){
      const div=document.createElement('div');
      div.className='fan-card';
      div.style.cssText=`left:${i*11}px;bottom:0;transform:rotate(${(i-count/2)*2.5}deg);z-index:${i}`;
      div.innerHTML=backSVG(true);
      fan.appendChild(div);
    }
    if(p.hand.length>10){
      const more=document.createElement('div');
      more.style.cssText='position:absolute;right:-30px;bottom:8px;font-size:10px;color:rgba(212,168,71,.4);white-space:nowrap';
      more.textContent=`+${p.hand.length-10}`;
      fan.style.position='relative';
      fan.appendChild(more);
    }
    wrap.appendChild(fan);
    zone.appendChild(wrap);
  });
}

function renderHand() {
  const wrap=document.getElementById('hand-wrap');
  wrap.innerHTML='';
  const myTurn=G.cur===0;
  const top=G.pile[G.pile.length-1];
  const hand=G.players[0].hand;

  hand.forEach((card,i)=>{
    const playable=myTurn&&canPlay(card,top,G.curCol);
    const isSel=selectedIdx===i;
    const div=document.createElement('div');
    div.className='h-card'+(playable?' playable':'')+(isSel?' selected':'')+(myTurn&&!playable?' h-card-dim':'');
    div.style.marginLeft=i>0?'-24px':'0';
    div.style.zIndex=isSel?999:hand.length-i;
    if(!isSel) div.style.transform=playable?'translateY(-14px)':'translateY(0)';
    div.style.animation=`cardIn .3s ease ${Math.min(i*.04,.4)}s both`;
    div.innerHTML=cardSVG(card,{glow:isSel,lift:playable&&!isSel});
    if(playable) div.addEventListener('click',()=>handleCardClick(i));
    wrap.appendChild(div);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleCardClick(idx) {
  if(!G||G.cur!==0||G.over) return;
  const card=G.players[0].hand[idx];
  const top=G.pile[G.pile.length-1];
  if(!canPlay(card,top,G.curCol)){toast("Can't play that card",'#8b0000');return;}
  if(card.kind==='wild'){
    selectedIdx=idx;renderHand();
    document.getElementById('color-overlay').classList.add('show');
  } else {
    selectedIdx=idx;renderHand();
    setTimeout(()=>doPlay(idx,null),140);
  }
}

function doPlay(idx,chosenCol) {
  if(!G||G.cur!==0||G.over) return;
  const card=G.players[0].hand[idx];
  const top=G.pile[G.pile.length-1];
  if(!canPlay(card,top,G.curCol)) return;
  G.players[0].hand.splice(idx,1);
  G.pile.push(card);
  G.curCol=card.kind==='wild'?chosenCol:card.col;
  selectedIdx=null;
  toast(`You played ${LABELS[card.val]??card.val}`,card.col==='wild'?chosenCol:card.col);
  if(!G.players[0].hand.length){endGame('You');return;}
  if(G.players[0].hand.length===1) toast('UNO! ğŸƒ','yellow');
  applyEffect(card,0);
  renderGame();
  scheduleBotTurn();
}

function doDraw() {
  if(!G||G.cur!==0||G.over) return;
  const n=G.stack>0?G.stack:1;
  drawN(0,n);
  if(G.stack>0){toast(`You drew ${n} cards`,'blue');G.stack=0;}
  else toast('Drew a card','blue');
  const len=G.players.length;
  G.cur=(G.cur+G.dir+len)%len;
  selectedIdx=null;
  renderGame();
  scheduleBotTurn();
}

function drawN(pid,n) {
  for(let i=0;i<n;i++){
    if(G.deck.length===0){const t=G.pile.pop();G.deck=shuffle(G.pile);G.pile=[t];}
    if(G.deck.length>0) G.players[pid].hand.push(G.deck.pop());
  }
}

function applyEffect(card,pid) {
  const n=G.players.length;
  let next=(G.cur+G.dir+n)%n;
  if(card.val==='Rev'){
    G.dir*=-1;next=(G.cur+G.dir+n)%n;
    toast(`${G.players[pid].name} reversed direction!`,'wild');
  } else if(card.val==='Skip'){
    const skip=next;next=(next+G.dir+n)%n;
    toast(`${G.players[skip].name} is skipped!`,card.col);
  } else if(card.val==='+2'){
    G.stack+=2;toast(`+2! ${G.players[next].name} must draw`,card.col);
  } else if(card.val==='W+4'){
    G.stack+=4;toast(`Wild +4! Draw ${G.stack}!`,'wild');
  }
  G.cur=next;
}

function endGame(winner) {
  G.over=true;G.winner=winner;
  document.getElementById('win-name-el').textContent=winner;
  document.getElementById('win-overlay').classList.add('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOT AI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function scheduleBotTurn() {
  clearTimeout(botTimer);
  if(!G||G.over||G.cur===0) return;
  botTimer=setTimeout(doBotTurn,850+Math.random()*550);
}

function doBotTurn() {
  if(!G||G.over||G.cur===0) return;
  const bid=G.cur,bot=G.players[bid];
  const top=G.pile[G.pile.length-1];
  const n=G.players.length;

  if(G.stack>0){
    const canBlock=bot.hand.some(c=>c.val==='+2'||c.val==='W+4');
    if(!canBlock){
      drawN(bid,G.stack);
      toast(`${bot.name} drew ${G.stack}`,'#c0392b');
      G.stack=0;G.cur=(bid+G.dir+n)%n;
      renderGame();scheduleBotTurn();return;
    }
  }

  const playable=bot.hand.map((c,i)=>({c,i})).filter(({c})=>canPlay(c,top,G.curCol));
  if(!playable.length){
    drawN(bid,1);toast(`${bot.name} draws`,'#8B6914');
    G.cur=(bid+G.dir+n)%n;renderGame();scheduleBotTurn();return;
  }

  let pick=playable.find(({c})=>c.val==='+2')||
           playable.find(({c})=>c.val==='Skip')||
           playable.find(({c})=>c.val==='Rev')||
           (bot.hand.length<=3&&playable.find(({c})=>c.val==='W+4'))||
           playable.find(({c})=>c.kind!=='wild')||playable[0];

  const card=pick.c;
  bot.hand.splice(pick.i,1);
  G.pile.push(card);

  let cc=card.col;
  if(card.kind==='wild'){
    const cnt={red:0,yellow:0,green:0,blue:0};
    bot.hand.forEach(c=>{if(c.col!=='wild')cnt[c.col]++;});
    cc=COLORS.reduce((a,b)=>cnt[a]>=cnt[b]?a:b);
  }
  G.curCol=card.kind==='wild'?cc:card.col;
  toast(`${bot.name} played ${LABELS[card.val]??card.val}`,G.curCol);

  if(!bot.hand.length){renderGame();endGame(bot.name);return;}
  if(bot.hand.length===1) toast(`${bot.name} â€” UNO!`,'yellow');

  applyEffect(card,bid);
  renderGame();
  scheduleBotTurn();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOASTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toast(txt, accent) {
  const el=document.createElement('div');
  el.className='toast';
  const bg=CHEX[accent]||accent||'rgba(212,168,71,.2)';
  el.style.cssText=`background:${CHEX[accent]?bg+'cc':bg};border-color:${bg}66`;
  el.textContent=txt;
  document.getElementById('toasts').prepend(el);
  setTimeout(()=>el.remove(),2600);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN / OVERLAY HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function closeOverlays() {
  document.querySelectorAll('.overlay').forEach(o=>o.classList.remove('show'));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLOATING MENU CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function spawnFloatingCards() {
  const wrap=document.getElementById('bg-cards-wrap');
  const cards=[
    {col:'red',val:'7',kind:'num', x:'7%',y:'12%',ft:'translateY(0) rotate(-14deg)',fth:'translateY(-18px) rotate(-9deg)',d:3.8,del:0},
    {col:'blue',val:'Skip',kind:'act',x:'82%',y:'8%', ft:'translateY(0) rotate(16deg)',fth:'translateY(-14px) rotate(21deg)',d:4.5,del:.6},
    {col:'green',val:'+2',kind:'act',x:'3%',y:'60%', ft:'translateY(0) rotate(-7deg)',fth:'translateY(-20px) rotate(-2deg)',d:3.3,del:1.2},
    {col:'yellow',val:'9',kind:'num',x:'85%',y:'65%',ft:'translateY(0) rotate(20deg)',fth:'translateY(-16px) rotate(15deg)',d:5,del:.3},
    {col:'wild',val:'Wild',kind:'wild',x:'74%',y:'24%',ft:'translateY(0) rotate(-11deg)',fth:'translateY(-12px) rotate(-6deg)',d:4.2,del:.9},
    {col:'red',val:'Rev',kind:'act',x:'12%',y:'75%', ft:'translateY(0) rotate(8deg)',fth:'translateY(-15px) rotate(13deg)',d:3.6,del:1.5},
  ];
  cards.forEach(c=>{
    const div=document.createElement('div');
    div.className='bg-card';
    div.style.cssText=`left:${c.x};top:${c.y};--ft:${c.ft};--fth:${c.fth};animation:floatCard ${c.d}s ease-in-out ${c.del}s infinite;transform:${c.ft}`;
    div.innerHTML=cardSVG({col:c.col,val:c.val,kind:c.kind},{});
    wrap.appendChild(div);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVENT LISTENERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Player count
document.querySelectorAll('.p-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    numPlayers=parseInt(btn.dataset.n);
    document.querySelectorAll('.p-btn').forEach(b=>b.classList.remove('sel'));
    btn.classList.add('sel');
  });
});

// Deal
document.getElementById('deal-btn').addEventListener('click', startGame);

// Draw pile click
document.getElementById('draw-stack').addEventListener('click',()=>{
  if(G&&G.cur===0&&!G.over) doDraw();
});

// Color picker
document.querySelectorAll('.cp-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const col=btn.dataset.c;
    document.getElementById('color-overlay').classList.remove('show');
    if(selectedIdx!==null) doPlay(selectedIdx,col);
  });
  btn.addEventListener('mouseenter',()=>{
    btn.style.transform='scale(1.18) translateY(-5px)';
    btn.style.boxShadow=`0 10px 28px ${CHEX[btn.dataset.c]}, 0 0 0 3px rgba(212,168,71,.5)`;
  });
  btn.addEventListener('mouseleave',()=>{
    btn.style.transform='';
    btn.style.boxShadow=`0 4px 16px ${CHEX[btn.dataset.c]}66`;
  });
});

// Win screen buttons
document.getElementById('win-play-btn').addEventListener('click', startGame);
document.getElementById('win-menu-btn').addEventListener('click',()=>{
  clearTimeout(botTimer);G=null;selectedIdx=null;closeOverlays();showScreen('menu');
});

// Back to menu
document.getElementById('menu-btn').addEventListener('click',()=>{
  clearTimeout(botTimer);G=null;selectedIdx=null;closeOverlays();showScreen('menu');
});

// Boot
spawnFloatingCards();
</script>
</body>
</html>
